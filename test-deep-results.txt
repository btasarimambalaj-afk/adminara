
> hayday-webrtc-support@1.3.8 test:deep
> jest --config=jest.deep.config.js

FAIL tests/integration/webrtc-deep.test.js
  ● WebRTC Deep Tests › ICE candidate gathering with timeout

    ReferenceError: RTCPeerConnection is not defined

    [0m [90m 12 |[39m
     [90m 13 |[39m   test([32m'ICE candidate gathering with timeout'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 14 |[39m     pc [33m=[39m [36mnew[39m [33mRTCPeerConnection[39m()[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 15 |[39m     [36mconst[39m candidates [33m=[39m [][33m;[39m
     [90m 16 |[39m     [36mlet[39m gatheringComplete [33m=[39m [36mfalse[39m[33m;[39m
     [90m 17 |[39m[0m

      at Object.pc (tests/integration/webrtc-deep.test.js:14:5)

  ● WebRTC Deep Tests › Connection state transitions

    ReferenceError: RTCPeerConnection is not defined

    [0m [90m 40 |[39m
     [90m 41 |[39m   test([32m'Connection state transitions'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 42 |[39m     pc [33m=[39m [36mnew[39m [33mRTCPeerConnection[39m()[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 43 |[39m     [36mconst[39m states [33m=[39m [][33m;[39m
     [90m 44 |[39m
     [90m 45 |[39m     pc[33m.[39monconnectionstatechange [33m=[39m () [33m=>[39m {[0m

      at Object.pc (tests/integration/webrtc-deep.test.js:42:5)

PASS tests/security/csrf-protection.test.js
FAIL tests/integration/state-deep.test.js
  ● Test suite failed to run

    Cannot find module '../../utils/redis' from 'tests/integration/state-deep.test.js'

    [0m [90m 1 |[39m [90m// tests/integration/state-deep.test.js - State Management Deep Tests[39m
     [90m 2 |[39m
    [31m[1m>[22m[39m[90m 3 |[39m [36mconst[39m redis [33m=[39m require([32m'../../utils/redis'[39m)[33m;[39m
     [90m   |[39m               [31m[1m^[22m[39m
     [90m 4 |[39m [36mconst[39m [33mStateStore[39m [33m=[39m require([32m'../../utils/state-store'[39m)[33m;[39m
     [90m 5 |[39m
     [90m 6 |[39m describe([32m'State Management Deep Tests'[39m[33m,[39m () [33m=>[39m {[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/state-deep.test.js:3:15)

  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/encryption.js:2:16)
      at Object.require (tests/security/pii-masking.test.js:1:21)
FAIL tests/integration/socket-deep.test.js
  ● Test suite failed to run

    Cannot find module '../helpers/server-helper' from 'tests/integration/socket-deep.test.js'

    [0m [90m 2 |[39m
     [90m 3 |[39m [36mconst[39m io [33m=[39m require([32m'socket.io-client'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m { startServer[33m,[39m stopServer } [33m=[39m require([32m'../helpers/server-helper'[39m)[33m;[39m
     [90m   |[39m                                     [31m[1m^[22m[39m
     [90m 5 |[39m
     [90m 6 |[39m describe([32m'Socket.IO Deep Tests'[39m[33m,[39m () [33m=>[39m {
     [90m 7 |[39m   [36mlet[39m server[33m,[39m socket[33m;[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/socket-deep.test.js:4:37)

FAIL tests/integration/api-deep.test.js
  ● Test suite failed to run

    Cannot find module '../helpers/server-helper' from 'tests/integration/api-deep.test.js'

    [0m [90m 2 |[39m
     [90m 3 |[39m [36mconst[39m request [33m=[39m require([32m'supertest'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m { startServer[33m,[39m stopServer } [33m=[39m require([32m'../helpers/server-helper'[39m)[33m;[39m
     [90m   |[39m                                     [31m[1m^[22m[39m
     [90m 5 |[39m
     [90m 6 |[39m describe([32m'API Endpoints Deep Tests'[39m[33m,[39m () [33m=>[39m {
     [90m 7 |[39m   [36mlet[39m server[33m,[39m app[33m;[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/api-deep.test.js:4:37)

FAIL tests/security/cors-deep.test.js
  ● Test suite failed to run

    Cannot find module '../helpers/server-helper' from 'tests/security/cors-deep.test.js'

    [0m [90m 2 |[39m
     [90m 3 |[39m [36mconst[39m request [33m=[39m require([32m'supertest'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m { startServer[33m,[39m stopServer } [33m=[39m require([32m'../helpers/server-helper'[39m)[33m;[39m
     [90m   |[39m                                     [31m[1m^[22m[39m
     [90m 5 |[39m
     [90m 6 |[39m describe([32m'CORS Deep Tests'[39m[33m,[39m () [33m=>[39m {
     [90m 7 |[39m   [36mlet[39m server[33m,[39m app[33m;[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/security/cors-deep.test.js:4:37)

FAIL tests/integration/session-cookie.test.js
  ● httpOnly cookie session › OTP verify sets httpOnly+Strict cookie

    Cannot find module '../../utils/session' from 'tests/integration/session-cookie.test.js'

    [0m [90m 11 |[39m     app[33m.[39muse(cookieParser([32m'test-secret'[39m))[33m;[39m
     [90m 12 |[39m
    [31m[1m>[22m[39m[90m 13 |[39m     [36mconst[39m { issueToken[33m,[39m validateToken[33m,[39m revokeToken[33m,[39m [33mSESS_TTL_MS[39m } [33m=[39m require([32m'../../utils/session'[39m)[33m;[39m
     [90m    |[39m                                                                     [31m[1m^[22m[39m
     [90m 14 |[39m
     [90m 15 |[39m     [36mfunction[39m setSessionCookie(res[33m,[39m token[33m,[39m ttl [33m=[39m [33mSESS_TTL_MS[39m) {
     [90m 16 |[39m       res[33m.[39mcookie([32m'adminSession'[39m[33m,[39m token[33m,[39m {[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/session-cookie.test.js:13:69)

  ● httpOnly cookie session › session verify requires cookie

    Cannot find module '../../utils/session' from 'tests/integration/session-cookie.test.js'

    [0m [90m 11 |[39m     app[33m.[39muse(cookieParser([32m'test-secret'[39m))[33m;[39m
     [90m 12 |[39m
    [31m[1m>[22m[39m[90m 13 |[39m     [36mconst[39m { issueToken[33m,[39m validateToken[33m,[39m revokeToken[33m,[39m [33mSESS_TTL_MS[39m } [33m=[39m require([32m'../../utils/session'[39m)[33m;[39m
     [90m    |[39m                                                                     [31m[1m^[22m[39m
     [90m 14 |[39m
     [90m 15 |[39m     [36mfunction[39m setSessionCookie(res[33m,[39m token[33m,[39m ttl [33m=[39m [33mSESS_TTL_MS[39m) {
     [90m 16 |[39m       res[33m.[39mcookie([32m'adminSession'[39m[33m,[39m token[33m,[39m {[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/session-cookie.test.js:13:69)

  ● httpOnly cookie session › session verify accepts valid cookie

    Cannot find module '../../utils/session' from 'tests/integration/session-cookie.test.js'

    [0m [90m 11 |[39m     app[33m.[39muse(cookieParser([32m'test-secret'[39m))[33m;[39m
     [90m 12 |[39m
    [31m[1m>[22m[39m[90m 13 |[39m     [36mconst[39m { issueToken[33m,[39m validateToken[33m,[39m revokeToken[33m,[39m [33mSESS_TTL_MS[39m } [33m=[39m require([32m'../../utils/session'[39m)[33m;[39m
     [90m    |[39m                                                                     [31m[1m^[22m[39m
     [90m 14 |[39m
     [90m 15 |[39m     [36mfunction[39m setSessionCookie(res[33m,[39m token[33m,[39m ttl [33m=[39m [33mSESS_TTL_MS[39m) {
     [90m 16 |[39m       res[33m.[39mcookie([32m'adminSession'[39m[33m,[39m token[33m,[39m {[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/session-cookie.test.js:13:69)

  ● httpOnly cookie session › logout clears cookie

    Cannot find module '../../utils/session' from 'tests/integration/session-cookie.test.js'

    [0m [90m 11 |[39m     app[33m.[39muse(cookieParser([32m'test-secret'[39m))[33m;[39m
     [90m 12 |[39m
    [31m[1m>[22m[39m[90m 13 |[39m     [36mconst[39m { issueToken[33m,[39m validateToken[33m,[39m revokeToken[33m,[39m [33mSESS_TTL_MS[39m } [33m=[39m require([32m'../../utils/session'[39m)[33m;[39m
     [90m    |[39m                                                                     [31m[1m^[22m[39m
     [90m 14 |[39m
     [90m 15 |[39m     [36mfunction[39m setSessionCookie(res[33m,[39m token[33m,[39m ttl [33m=[39m [33mSESS_TTL_MS[39m) {
     [90m 16 |[39m       res[33m.[39mcookie([32m'adminSession'[39m[33m,[39m token[33m,[39m {[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/session-cookie.test.js:13:69)

PASS tests/integration/metrics-guard.test.js
FAIL tests/security/sql-injection.test.js
  ● Security: SQL Injection › should reject SQL injection in params

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "OR 1=1"
    Received string:        "SELECT * FROM users WHERE id = 1 OR 1=1"

    [0m [90m 18 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m`/user/${sqlPayload}`[39m)[33m;[39m
     [90m 19 |[39m
    [31m[1m>[22m[39m[90m 20 |[39m     expect(res[33m.[39mbody[33m.[39mquery)[33m.[39mnot[33m.[39mtoContain([32m'OR 1=1'[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   test([32m'should reject UNION attacks'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (tests/security/sql-injection.test.js:20:32)

  ● Security: SQL Injection › should reject UNION attacks

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "UNION"
    Received string:        "SELECT * FROM users WHERE id = 1 UNION SELECT * FROM admin"

    [0m [90m 25 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m`/user/${encodeURIComponent(sqlPayload)}`[39m)[33m;[39m
     [90m 26 |[39m
    [31m[1m>[22m[39m[90m 27 |[39m     expect(res[33m.[39mbody[33m.[39mquery)[33m.[39mnot[33m.[39mtoContain([32m'UNION'[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 28 |[39m   })[33m;[39m
     [90m 29 |[39m
     [90m 30 |[39m   test([32m'should reject comment injection'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (tests/security/sql-injection.test.js:27:32)

  ● Security: SQL Injection › should reject comment injection

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "DROP TABLE"
    Received string:        "SELECT * FROM users WHERE id = 1; DROP TABLE users--"

    [0m [90m 32 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m`/user/${encodeURIComponent(sqlPayload)}`[39m)[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m     expect(res[33m.[39mbody[33m.[39mquery)[33m.[39mnot[33m.[39mtoContain([32m'DROP TABLE'[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 35 |[39m   })[33m;[39m
     [90m 36 |[39m })[33m;[39m
     [90m 37 |[39m[0m

      at Object.toContain (tests/security/sql-injection.test.js:34:32)

PASS tests/integration/config-turn.test.js
PASS tests/integration/turn-server.test.js
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.<anonymous> (socket/handlers.js:1:42)
      at Namespace.require (tests/integration/socket-handlers.test.js:21:7)
      at Namespace.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Namespace._doConnect (node_modules/socket.io/dist/namespace.js:276:14)
      at node_modules/socket.io/dist/namespace.js:238:22
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.<anonymous> (socket/handlers.js:1:42)
      at Object.require (tests/integration/webrtc-signaling.test.js:4:24)
FAIL tests/security/xss-injection.test.js
  ● Security: XSS Injection › should reject script tags

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "<script>"
    Received string:        "<script>alert(\"XSS\")</script>"

    [0m [90m 17 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39mpost([32m'/chat/message'[39m)[33m.[39msend({ message[33m:[39m xssPayload })[33m;[39m
     [90m 18 |[39m
    [31m[1m>[22m[39m[90m 19 |[39m     expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mnot[33m.[39mtoContain([32m'<script>'[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 20 |[39m   })[33m;[39m
     [90m 21 |[39m
     [90m 22 |[39m   test([32m'should reject event handlers'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (tests/security/xss-injection.test.js:19:34)

  ● Security: XSS Injection › should reject event handlers

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "onerror"
    Received string:        "<img src=x onerror=\"alert(1)\">"

    [0m [90m 24 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39mpost([32m'/chat/message'[39m)[33m.[39msend({ message[33m:[39m xssPayload })[33m;[39m
     [90m 25 |[39m
    [31m[1m>[22m[39m[90m 26 |[39m     expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mnot[33m.[39mtoContain([32m'onerror'[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 27 |[39m   })[33m;[39m
     [90m 28 |[39m
     [90m 29 |[39m   test([32m'should reject javascript: protocol'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (tests/security/xss-injection.test.js:26:34)

  ● Security: XSS Injection › should reject javascript: protocol

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "javascript:"
    Received string:        "<a href=\"javascript:alert(1)\">Click</a>"

    [0m [90m 31 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39mpost([32m'/chat/message'[39m)[33m.[39msend({ message[33m:[39m xssPayload })[33m;[39m
     [90m 32 |[39m
    [31m[1m>[22m[39m[90m 33 |[39m     expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mnot[33m.[39mtoContain([32m'javascript:'[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 34 |[39m   })[33m;[39m
     [90m 35 |[39m })[33m;[39m
     [90m 36 |[39m[0m

      at Object.toContain (tests/security/xss-injection.test.js:33:34)

  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (tests/security/auth-bypass.test.js:4:16)
PASS tests/integration/socket.test.js
PASS tests/integration/metrics-reconnect.test.js
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.require (routes/index.js:3:16)
      at Object.require (tests/integration/api.test.js:3:16)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/auth.js:5:16)
      at Object.require (tests/integration/v1-routes.test.js:3:25)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/encryption.js:2:16)
      at Object.require (tests/security/pii-masking.test.js:1:21)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.<anonymous> (socket/handlers.js:1:42)
      at Object.require (tests/integration/webrtc-signaling.test.js:4:24)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (tests/security/auth-bypass.test.js:4:16)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.<anonymous> (socket/handlers.js:1:42)
      at Namespace.require (tests/integration/socket-handlers.test.js:21:7)
      at Namespace.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Namespace._doConnect (node_modules/socket.io/dist/namespace.js:276:14)
      at node_modules/socket.io/dist/namespace.js:238:22
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/encryption.js:2:16)
      at Object.require (tests/security/pii-masking.test.js:1:21)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.require (routes/index.js:3:16)
      at Object.require (tests/integration/api.test.js:3:16)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/auth.js:5:16)
      at Object.require (tests/integration/v1-routes.test.js:3:25)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/encryption.js:2:16)
      at Object.require (tests/security/pii-masking.test.js:1:21)
FAIL tests/security/pii-masking.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.<anonymous> (socket/handlers.js:1:42)
      at Object.require (tests/integration/webrtc-signaling.test.js:4:24)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (tests/security/auth-bypass.test.js:4:16)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.<anonymous> (socket/handlers.js:1:42)
      at Namespace.require (tests/integration/socket-handlers.test.js:21:7)
      at Namespace.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Namespace._doConnect (node_modules/socket.io/dist/namespace.js:276:14)
      at node_modules/socket.io/dist/namespace.js:238:22
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.require (routes/index.js:3:16)
      at Object.require (tests/integration/api.test.js:3:16)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/auth.js:5:16)
      at Object.require (tests/integration/v1-routes.test.js:3:25)
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.<anonymous> (socket/handlers.js:1:42)
      at Object.require (tests/integration/webrtc-signaling.test.js:4:24)
FAIL tests/integration/webrtc-signaling.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.<anonymous> (socket/handlers.js:1:42)
      at Namespace.require (tests/integration/socket-handlers.test.js:21:7)
      at Namespace.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Namespace._doConnect (node_modules/socket.io/dist/namespace.js:276:14)
      at node_modules/socket.io/dist/namespace.js:238:22
  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (tests/security/auth-bypass.test.js:4:16)
FAIL tests/security/auth-bypass.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

FAIL tests/integration/socket-handlers.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/logger.js:5:16)
      at Object.require (routes/index.js:3:16)
      at Object.require (tests/integration/api.test.js:3:16)
FAIL tests/integration/api.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

  ●  process.exit called with "1"

    [0m [90m 2 |[39m [36mconst[39m crypto [33m=[39m require([32m'crypto'[39m)[33m;[39m
     [90m 3 |[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m env [33m=[39m envalid[33m.[39mcleanEnv(
     [90m   |[39m                     [31m[1m^[22m[39m
     [90m 5 |[39m   process[33m.[39menv[33m,[39m
     [90m 6 |[39m   {
     [90m 7 |[39m     [33mNODE_ENV[39m[33m:[39m envalid[33m.[39mstr({[0m

      at defaultReporter (node_modules/envalid/src/reporter.ts:80:13)
      at getSanitizedEnv (node_modules/envalid/src/core.ts:120:3)
      at Object.cleanEnv (node_modules/envalid/src/envalid.ts:18:34)
      at Object.cleanEnv (config/index.js:4:21)
      at Object.require (utils/auth.js:5:16)
      at Object.require (tests/integration/v1-routes.test.js:3:25)
FAIL tests/integration/v1-routes.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

FAIL tests/integration/chat.test.js (11.719 s)
  ● Chat System Integration › should send chat message

    thrown: "Exceeded timeout of 10000 ms for a test while waiting for `done()` to be called.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 32 |[39m   })[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m   test([32m'should send chat message'[39m[33m,[39m done [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 35 |[39m     [36mconst[39m message [33m=[39m [32m'Hello from customer'[39m[33m;[39m
     [90m 36 |[39m
     [90m 37 |[39m     adminSocket[33m.[39mon([32m'chat:message'[39m[33m,[39m data [33m=>[39m {[0m

      at test (tests/integration/chat.test.js:34:3)
      at Object.describe (tests/integration/chat.test.js:5:1)

Summary of all failing tests
FAIL tests/integration/webrtc-deep.test.js
  ● WebRTC Deep Tests › ICE candidate gathering with timeout

    ReferenceError: RTCPeerConnection is not defined

    [0m [90m 12 |[39m
     [90m 13 |[39m   test([32m'ICE candidate gathering with timeout'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 14 |[39m     pc [33m=[39m [36mnew[39m [33mRTCPeerConnection[39m()[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 15 |[39m     [36mconst[39m candidates [33m=[39m [][33m;[39m
     [90m 16 |[39m     [36mlet[39m gatheringComplete [33m=[39m [36mfalse[39m[33m;[39m
     [90m 17 |[39m[0m

      at Object.pc (tests/integration/webrtc-deep.test.js:14:5)

  ● WebRTC Deep Tests › Connection state transitions

    ReferenceError: RTCPeerConnection is not defined

    [0m [90m 40 |[39m
     [90m 41 |[39m   test([32m'Connection state transitions'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 42 |[39m     pc [33m=[39m [36mnew[39m [33mRTCPeerConnection[39m()[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 43 |[39m     [36mconst[39m states [33m=[39m [][33m;[39m
     [90m 44 |[39m
     [90m 45 |[39m     pc[33m.[39monconnectionstatechange [33m=[39m () [33m=>[39m {[0m

      at Object.pc (tests/integration/webrtc-deep.test.js:42:5)

FAIL tests/integration/state-deep.test.js
  ● Test suite failed to run

    Cannot find module '../../utils/redis' from 'tests/integration/state-deep.test.js'

    [0m [90m 1 |[39m [90m// tests/integration/state-deep.test.js - State Management Deep Tests[39m
     [90m 2 |[39m
    [31m[1m>[22m[39m[90m 3 |[39m [36mconst[39m redis [33m=[39m require([32m'../../utils/redis'[39m)[33m;[39m
     [90m   |[39m               [31m[1m^[22m[39m
     [90m 4 |[39m [36mconst[39m [33mStateStore[39m [33m=[39m require([32m'../../utils/state-store'[39m)[33m;[39m
     [90m 5 |[39m
     [90m 6 |[39m describe([32m'State Management Deep Tests'[39m[33m,[39m () [33m=>[39m {[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/state-deep.test.js:3:15)

FAIL tests/integration/socket-deep.test.js
  ● Test suite failed to run

    Cannot find module '../helpers/server-helper' from 'tests/integration/socket-deep.test.js'

    [0m [90m 2 |[39m
     [90m 3 |[39m [36mconst[39m io [33m=[39m require([32m'socket.io-client'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m { startServer[33m,[39m stopServer } [33m=[39m require([32m'../helpers/server-helper'[39m)[33m;[39m
     [90m   |[39m                                     [31m[1m^[22m[39m
     [90m 5 |[39m
     [90m 6 |[39m describe([32m'Socket.IO Deep Tests'[39m[33m,[39m () [33m=>[39m {
     [90m 7 |[39m   [36mlet[39m server[33m,[39m socket[33m;[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/socket-deep.test.js:4:37)

FAIL tests/integration/api-deep.test.js
  ● Test suite failed to run

    Cannot find module '../helpers/server-helper' from 'tests/integration/api-deep.test.js'

    [0m [90m 2 |[39m
     [90m 3 |[39m [36mconst[39m request [33m=[39m require([32m'supertest'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m { startServer[33m,[39m stopServer } [33m=[39m require([32m'../helpers/server-helper'[39m)[33m;[39m
     [90m   |[39m                                     [31m[1m^[22m[39m
     [90m 5 |[39m
     [90m 6 |[39m describe([32m'API Endpoints Deep Tests'[39m[33m,[39m () [33m=>[39m {
     [90m 7 |[39m   [36mlet[39m server[33m,[39m app[33m;[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/api-deep.test.js:4:37)

FAIL tests/security/cors-deep.test.js
  ● Test suite failed to run

    Cannot find module '../helpers/server-helper' from 'tests/security/cors-deep.test.js'

    [0m [90m 2 |[39m
     [90m 3 |[39m [36mconst[39m request [33m=[39m require([32m'supertest'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mconst[39m { startServer[33m,[39m stopServer } [33m=[39m require([32m'../helpers/server-helper'[39m)[33m;[39m
     [90m   |[39m                                     [31m[1m^[22m[39m
     [90m 5 |[39m
     [90m 6 |[39m describe([32m'CORS Deep Tests'[39m[33m,[39m () [33m=>[39m {
     [90m 7 |[39m   [36mlet[39m server[33m,[39m app[33m;[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/security/cors-deep.test.js:4:37)

FAIL tests/integration/session-cookie.test.js
  ● httpOnly cookie session › OTP verify sets httpOnly+Strict cookie

    Cannot find module '../../utils/session' from 'tests/integration/session-cookie.test.js'

    [0m [90m 11 |[39m     app[33m.[39muse(cookieParser([32m'test-secret'[39m))[33m;[39m
     [90m 12 |[39m
    [31m[1m>[22m[39m[90m 13 |[39m     [36mconst[39m { issueToken[33m,[39m validateToken[33m,[39m revokeToken[33m,[39m [33mSESS_TTL_MS[39m } [33m=[39m require([32m'../../utils/session'[39m)[33m;[39m
     [90m    |[39m                                                                     [31m[1m^[22m[39m
     [90m 14 |[39m
     [90m 15 |[39m     [36mfunction[39m setSessionCookie(res[33m,[39m token[33m,[39m ttl [33m=[39m [33mSESS_TTL_MS[39m) {
     [90m 16 |[39m       res[33m.[39mcookie([32m'adminSession'[39m[33m,[39m token[33m,[39m {[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/session-cookie.test.js:13:69)

  ● httpOnly cookie session › session verify requires cookie

    Cannot find module '../../utils/session' from 'tests/integration/session-cookie.test.js'

    [0m [90m 11 |[39m     app[33m.[39muse(cookieParser([32m'test-secret'[39m))[33m;[39m
     [90m 12 |[39m
    [31m[1m>[22m[39m[90m 13 |[39m     [36mconst[39m { issueToken[33m,[39m validateToken[33m,[39m revokeToken[33m,[39m [33mSESS_TTL_MS[39m } [33m=[39m require([32m'../../utils/session'[39m)[33m;[39m
     [90m    |[39m                                                                     [31m[1m^[22m[39m
     [90m 14 |[39m
     [90m 15 |[39m     [36mfunction[39m setSessionCookie(res[33m,[39m token[33m,[39m ttl [33m=[39m [33mSESS_TTL_MS[39m) {
     [90m 16 |[39m       res[33m.[39mcookie([32m'adminSession'[39m[33m,[39m token[33m,[39m {[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/session-cookie.test.js:13:69)

  ● httpOnly cookie session › session verify accepts valid cookie

    Cannot find module '../../utils/session' from 'tests/integration/session-cookie.test.js'

    [0m [90m 11 |[39m     app[33m.[39muse(cookieParser([32m'test-secret'[39m))[33m;[39m
     [90m 12 |[39m
    [31m[1m>[22m[39m[90m 13 |[39m     [36mconst[39m { issueToken[33m,[39m validateToken[33m,[39m revokeToken[33m,[39m [33mSESS_TTL_MS[39m } [33m=[39m require([32m'../../utils/session'[39m)[33m;[39m
     [90m    |[39m                                                                     [31m[1m^[22m[39m
     [90m 14 |[39m
     [90m 15 |[39m     [36mfunction[39m setSessionCookie(res[33m,[39m token[33m,[39m ttl [33m=[39m [33mSESS_TTL_MS[39m) {
     [90m 16 |[39m       res[33m.[39mcookie([32m'adminSession'[39m[33m,[39m token[33m,[39m {[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/session-cookie.test.js:13:69)

  ● httpOnly cookie session › logout clears cookie

    Cannot find module '../../utils/session' from 'tests/integration/session-cookie.test.js'

    [0m [90m 11 |[39m     app[33m.[39muse(cookieParser([32m'test-secret'[39m))[33m;[39m
     [90m 12 |[39m
    [31m[1m>[22m[39m[90m 13 |[39m     [36mconst[39m { issueToken[33m,[39m validateToken[33m,[39m revokeToken[33m,[39m [33mSESS_TTL_MS[39m } [33m=[39m require([32m'../../utils/session'[39m)[33m;[39m
     [90m    |[39m                                                                     [31m[1m^[22m[39m
     [90m 14 |[39m
     [90m 15 |[39m     [36mfunction[39m setSessionCookie(res[33m,[39m token[33m,[39m ttl [33m=[39m [33mSESS_TTL_MS[39m) {
     [90m 16 |[39m       res[33m.[39mcookie([32m'adminSession'[39m[33m,[39m token[33m,[39m {[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (tests/integration/session-cookie.test.js:13:69)

FAIL tests/security/sql-injection.test.js
  ● Security: SQL Injection › should reject SQL injection in params

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "OR 1=1"
    Received string:        "SELECT * FROM users WHERE id = 1 OR 1=1"

    [0m [90m 18 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m`/user/${sqlPayload}`[39m)[33m;[39m
     [90m 19 |[39m
    [31m[1m>[22m[39m[90m 20 |[39m     expect(res[33m.[39mbody[33m.[39mquery)[33m.[39mnot[33m.[39mtoContain([32m'OR 1=1'[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   test([32m'should reject UNION attacks'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (tests/security/sql-injection.test.js:20:32)

  ● Security: SQL Injection › should reject UNION attacks

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "UNION"
    Received string:        "SELECT * FROM users WHERE id = 1 UNION SELECT * FROM admin"

    [0m [90m 25 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m`/user/${encodeURIComponent(sqlPayload)}`[39m)[33m;[39m
     [90m 26 |[39m
    [31m[1m>[22m[39m[90m 27 |[39m     expect(res[33m.[39mbody[33m.[39mquery)[33m.[39mnot[33m.[39mtoContain([32m'UNION'[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 28 |[39m   })[33m;[39m
     [90m 29 |[39m
     [90m 30 |[39m   test([32m'should reject comment injection'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (tests/security/sql-injection.test.js:27:32)

  ● Security: SQL Injection › should reject comment injection

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "DROP TABLE"
    Received string:        "SELECT * FROM users WHERE id = 1; DROP TABLE users--"

    [0m [90m 32 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m`/user/${encodeURIComponent(sqlPayload)}`[39m)[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m     expect(res[33m.[39mbody[33m.[39mquery)[33m.[39mnot[33m.[39mtoContain([32m'DROP TABLE'[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 35 |[39m   })[33m;[39m
     [90m 36 |[39m })[33m;[39m
     [90m 37 |[39m[0m

      at Object.toContain (tests/security/sql-injection.test.js:34:32)

FAIL tests/security/xss-injection.test.js
  ● Security: XSS Injection › should reject script tags

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "<script>"
    Received string:        "<script>alert(\"XSS\")</script>"

    [0m [90m 17 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39mpost([32m'/chat/message'[39m)[33m.[39msend({ message[33m:[39m xssPayload })[33m;[39m
     [90m 18 |[39m
    [31m[1m>[22m[39m[90m 19 |[39m     expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mnot[33m.[39mtoContain([32m'<script>'[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 20 |[39m   })[33m;[39m
     [90m 21 |[39m
     [90m 22 |[39m   test([32m'should reject event handlers'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (tests/security/xss-injection.test.js:19:34)

  ● Security: XSS Injection › should reject event handlers

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "onerror"
    Received string:        "<img src=x onerror=\"alert(1)\">"

    [0m [90m 24 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39mpost([32m'/chat/message'[39m)[33m.[39msend({ message[33m:[39m xssPayload })[33m;[39m
     [90m 25 |[39m
    [31m[1m>[22m[39m[90m 26 |[39m     expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mnot[33m.[39mtoContain([32m'onerror'[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 27 |[39m   })[33m;[39m
     [90m 28 |[39m
     [90m 29 |[39m   test([32m'should reject javascript: protocol'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (tests/security/xss-injection.test.js:26:34)

  ● Security: XSS Injection › should reject javascript: protocol

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "javascript:"
    Received string:        "<a href=\"javascript:alert(1)\">Click</a>"

    [0m [90m 31 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39mpost([32m'/chat/message'[39m)[33m.[39msend({ message[33m:[39m xssPayload })[33m;[39m
     [90m 32 |[39m
    [31m[1m>[22m[39m[90m 33 |[39m     expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mnot[33m.[39mtoContain([32m'javascript:'[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 34 |[39m   })[33m;[39m
     [90m 35 |[39m })[33m;[39m
     [90m 36 |[39m[0m

      at Object.toContain (tests/security/xss-injection.test.js:33:34)

FAIL tests/security/pii-masking.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

FAIL tests/integration/webrtc-signaling.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

FAIL tests/security/auth-bypass.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

FAIL tests/integration/socket-handlers.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

FAIL tests/integration/api.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

FAIL tests/integration/v1-routes.test.js
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

FAIL tests/integration/chat.test.js (11.719 s)
  ● Chat System Integration › should send chat message

    thrown: "Exceeded timeout of 10000 ms for a test while waiting for `done()` to be called.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 32 |[39m   })[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m   test([32m'should send chat message'[39m[33m,[39m done [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 35 |[39m     [36mconst[39m message [33m=[39m [32m'Hello from customer'[39m[33m;[39m
     [90m 36 |[39m
     [90m 37 |[39m     adminSocket[33m.[39mon([32m'chat:message'[39m[33m,[39m data [33m=>[39m {[0m

      at test (tests/integration/chat.test.js:34:3)
      at Object.describe (tests/integration/chat.test.js:5:1)


Test Suites: 15 failed, 6 passed, 21 total
Tests:       13 failed, 27 passed, 40 total
Snapshots:   0 total
Time:        12.4 s
Ran all test suites.
