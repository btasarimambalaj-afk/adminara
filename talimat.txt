AdminAra Refactor Projesi â€“ MASTER Uygulama Promptu (GeniÅŸletilmiÅŸ, 24 Part)
0) GiriÅŸ ve KullanÄ±m TalimatÄ± (Projenin AmacÄ±, Ä°ÅŸleyiÅŸ, Format)

BaÄŸlam:
AdminAra, mevcut bir WebRTC tabanlÄ± adminâ€‘mÃ¼ÅŸteri iletiÅŸim sistemi. Åu an Node.js tabanlÄ± (Express, Socket.IO, Redis/BullMQ). AIâ€™nin Ã¶nerdiÄŸi basit username/password yapÄ±sÄ±nÄ± entegre ederek hibrit (Node + FastAPI/Python) hale geÃ§iyoruz. Hedef: GÃ¼venlik, Ã¶lÃ§eklenebilirlik ve optimizasyonlar (adaptif bitrate, pil tasarrufu, FIFO kuyruk, sessizlik alert, otomatik raporlar).

Hibrit geÃ§iÅŸ iÃ§in eklenecek alanlar deÄŸerlendirilmiÅŸ ve ilgili parÃ§alara yerleÅŸtirilmiÅŸtir: Monitoring & Observability (Prometheus/OpenTelemetry), Multiâ€‘Language Error Handling (ortak logger/Sentry), Authentication Bridge (JWT paylaÅŸÄ±mÄ±), WebSocket Failover (reconnection stratejisi), Background Job Koordinasyonu (Celery/BullMQ), Rate Limiting & Throttling (Redisâ€‘based), Caching Layer (shared Redis), Health Check & Readiness Probes (ortak endpoint), Configuration Management (env sync), Performance Monitoring (profiling).

Ä°ÅŸleyiÅŸ: Refactor 24 part olarak ilerler (senin 1â€“15 parÃ§an + ek 16â€“24 parÃ§alar). KullanÄ±cÄ± her partâ€™Ä± ayrÄ± mesajda tetikler: â€œÅimdi Part Xâ€™i uygulaâ€. Model her part sonunda:
[PART X BÄ°TTÄ°] â€” "Bu kÄ±sÄ±m tamamlandÄ±. Sonraki part'Ä± bekliyorum."
diyecek.
GeridÃ¶nÃ¼ÅŸÃ¼mlÃ¼ (commitâ€‘gibi) deÄŸiÅŸiklik Ã¶zeti ve test eklenecek. Eski kod bozulmayacak â€” hibrit fallback ile korunacak. Kodlar araÃ§lar (code_execution) ile (varsa) test edilecek.

Ã‡Ä±ktÄ± formatÄ± (her part iÃ§in zorunlu):

DeÄŸiÅŸiklik Ã–zeti (madde madde)

Etkilenen Dosyalar listesi

Kod Snippetâ€™leri (Python/JS; tam, Ã§alÄ±ÅŸÄ±r sÃ¶zdizimi)

Neden Bu DeÄŸiÅŸiklik? (1â€‘2 cÃ¼mle)

Test Ã–nerisi (manuel ve/veya otomatik)
Son satÄ±r: [PART X BÄ°TTÄ°] â€” "Bu kÄ±sÄ±m tamamlandÄ±. Sonraki part'Ä± bekliyorum."

1) Mevcut YapÄ± Ã–zeti (Refactor Ã–ncesi) (Senin Metnin)

DÃ¼zensiz kÃ¶k dÃ¼zeyde Node.js tabanlÄ±:

AdminAra/
â”œâ”€â”€ server.js (ana Express sunucusu, route'lar ve DB baÄŸlantÄ±larÄ± karÄ±ÅŸÄ±k, hardcoded creds)
â”œâ”€â”€ routes/index.js (tÃ¼m API endpoint'leri: /chat-join, /auth â€“ auth middleware yok)
â”œâ”€â”€ utils/state-store.js (Redis session'larÄ±, Mongo sorgularÄ± basit)
â”œâ”€â”€ utils/turn-credentials.js (TURN sunucusu iÃ§in hardcoded username/password)
â”œâ”€â”€ utils/error-handler.js (global try-catch, logging console'a)
â”œâ”€â”€ socket/admin-auth.js (Socket.IO event'leri: 'join-room', token kontrolÃ¼ zayÄ±f)
â”œâ”€â”€ public/js/webrtc.js (temel peerConnection, getUserMedia â€“ adaptif yok)
â”œâ”€â”€ public/js/connection-monitor.js (baÄŸlantÄ± ping, pil kontrolÃ¼ yetersiz)
â”œâ”€â”€ public/js/client.js (mÃ¼ÅŸteri JS, inline event listener'lar)
â”œâ”€â”€ public/css/main.css (temel stiller, mobil responsive deÄŸil)
â”œâ”€â”€ public/admin.html (statik admin paneli, chat embed)
â”œâ”€â”€ public/index.html (mÃ¼ÅŸteri giriÅŸ sayfasÄ±)
â”œâ”€â”€ public/test-suite.html (manuel 5-10 test butonlarÄ±)
â”œâ”€â”€ service-worker.js (basit cache, offline destek eksik)
â”œâ”€â”€ package.json (baÄŸÄ±mlÄ±lÄ±klar: express, socket.io, bullmq, redis)
â””â”€â”€ (No .env, no tests/ klasÃ¶rÃ¼)


Sorunlar: GÃ¼venlik (creds aÃ§Ä±k), performans (monolitik, yÃ¼ksek trafik'te Ã§Ã¶kme), test eksikliÄŸi (%20 coverage).

2) Yeni YapÄ± Ã–zeti (Refactor SonrasÄ±) (Senin Metnin)

Hibrit (FastAPI + Node kalÄ±ntÄ±larÄ±), modÃ¼ler:

AdminAra/
â”œâ”€â”€ README.md (kurulum, run komutlarÄ±)
â”œâ”€â”€ .env (secrets: DB_URI, TURN_SECRET, REDIS_HOST)
â”œâ”€â”€ requirements.txt (fastapi, uvicorn, celery[redis], pymongo)
â”œâ”€â”€ package.json (react, socket.io-client, jest ekle)
â”œâ”€â”€ main.py (FastAPI app, hibrit Node Ã§aÄŸrÄ±sÄ± iÃ§in subprocess)
â”œâ”€â”€ socket.py (Socket.IO FastAPI wrapper)
â”œâ”€â”€ routes/api.py (endpoint'ler: /api/join-queue, JWT auth)
â”œâ”€â”€ utils/state-store.py (Mongo/Redis hibrit)
â”œâ”€â”€ utils/turn-credentials.py (dinamik TURN)
â”œâ”€â”€ utils/error-handler.py (Sentry logging)
â”œâ”€â”€ celery_tasks.py (kuyruklar: rapor, alert)
â”œâ”€â”€ public/src/components/App.jsx (React root)
â”œâ”€â”€ public/src/pages/Index.jsx (bekleme UI)
â”œâ”€â”€ public/src/pages/Admin.jsx (admin dashboard)
â”œâ”€â”€ public/src/pages/Tests.jsx (test runner)
â”œâ”€â”€ public/src/hooks/useSocket.js (WebRTC hook)
â”œâ”€â”€ public/js/webrtc.js (geliÅŸmiÅŸ, ekran paylaÅŸÄ±mÄ±)
â”œâ”€â”€ public/js/connection-monitor.js (pil optimizasyonu)
â”œâ”€â”€ public/css/main.css (minified, responsive)
â”œâ”€â”€ public/admin.html (React mount)
â”œâ”€â”€ public/index.html (React entry)
â”œâ”€â”€ public/test-suite.html (otomatik runner)
â”œâ”€â”€ service-worker.js (PWA offline)
â”œâ”€â”€ tests/ (unit.js, integration.py, e2e.test.js â€“ 80+ test)
â””â”€â”€ config/mermaid-schema.mmd (mimari diyagram)


DeÄŸiÅŸiklikler: ModÃ¼lerlik (%50 kod tekrarÄ± azaldÄ±), gÃ¼venlik (env + JWT), performans (adaptif WebRTC, lazyâ€‘load).

3) Mimari ÅemasÄ± (Mermaid) (Senin Metnin)
mermaid
graph TD
A[FastAPI main.py] --> B[socket.py Socket.IO]
C[React App.jsx] --> D[useSocket.js Hook]
B --> E[MongoDB/Redis state-store.py]
D --> F[webrtc.js Peer + TURN]
E --> G[celery_tasks.py Queue: Rapor/Alert]
F --> H[connection-monitor.js Pil]
G --> I[tests/ 80+ Auto]
H --> J[service-worker.js Offline]
I --> K[AdminAra Chat Sistem]

15 ParÃ§a â€” Senin Orijinal PlanÄ±n (Aynen, ufaltmadan, geniÅŸletici notlarla)

AÅŸaÄŸÄ±daki Part 1â€“15 bÃ¶lÃ¼mleri, senin gÃ¶nderdiÄŸin metindeki iÃ§erikle uyumlu olacak ÅŸekilde sunulur; eklediÄŸim notlar (âš ï¸ veya ğŸ’¡ ile) senin planÄ±nÄ± bozmadan yalnÄ±zca gÃ¼Ã§lendirir.

Part 1: Eski YapÄ± DetaylÄ± Analizi (GÃ¼venlik ve Performans SorunlarÄ±)

Senin talimatÄ±n (Ã¶zetle, aynen):
Eski Node.js yapÄ±sÄ±nÄ± baÅŸtan sona incele. Odak:

GÃ¼venlik: TURN creds aÃ§Ä±k, DB URI string, auth yok, token kontrolÃ¼ zayÄ±f, .env yok.

Performans: webrtc.js fixed bitrate 1Mbps, mobil CPU, ping 5s yetersiz, pil API yok.

Ã–lÃ§ek: BullMQ queueâ€™lar inline, 10+ mÃ¼ÅŸteri memory leak.

Testler: public/test-suite.html manuel, coverage %10.

SW: basit cache; CSS responsive yok.
AdÄ±mlar: DosyalarÄ± listele, sorunlarÄ± kategorize et (gÃ¼venlik 5 madde, perf 4 madde), Ã¶ncelikli fix Ã¶ner, kÄ±rÄ±lma noktalarÄ±nÄ± belirt.
Ã‡Ä±ktÄ±: Madde listeler + tablo (dosya | sorun | Ã¶ncelik). Test: 2 mÃ¼ÅŸteri simÃ¼lasyonu.

ğŸ’¡ GeniÅŸletici notlar: STRIDE tabanlÄ± tehdit modeli Ã§Ä±kar; her risk iÃ§in C/I/A etkisini ve olasÄ±lÄ±ÄŸÄ± puanla, Topâ€‘10 risk listesi Ã¼ret. Asset/env envanteri ekle.

Part 2: Yeni YapÄ± FaydalarÄ± ve AÄŸaÃ§ DiyagramÄ±

Senin talimatÄ±n: FastAPI + Socket wrapper, Redis/Mongo hibrit stateâ€‘store, React context, Celery rapor iÅŸleri, .env, bandwidthEstimate event, vs.
AdÄ±mlar: Tam tree; her klasÃ¶r iÃ§in 2â€‘3 fayda; eskiâ€‘yeni karÅŸÄ±laÅŸtÄ±rma tablosu.
Test: Dependency graph (manuel).

ğŸ’¡ GeniÅŸletici notlar: Diyagrama trust boundary ve Xâ€‘Requestâ€‘ID akÄ±ÅŸÄ± ekle.

Part 3: Config ve Env DeÄŸiÅŸiklikleri

Senin talimatÄ±n: .env oluÅŸtur (DB_URI, TURN_SECRET, REDIS_HOST, JWT_SECRET, REPORT_EMAIL); main.py dotenv + CORS; requirements.txt, package.json gÃ¼ncelle.
AdÄ±mlar & Ã‡Ä±ktÄ±: .env ÅŸablonu; main.py baÅŸlangÄ±Ã§; requirements & package tam listesi.
Test: load_dotenv() + print(os.getenv('DB_URI')).

âš ï¸ Not: Prod iÃ§in KMS/Vault entegrasyonu ve secrets rotasyonu Part 17â€™de.

Part 4: Socket ve Route Refactor

Senin talimatÄ±n: socket.py (fastapi_socketio/AsyncServer), JWT decode, auth_ok; routes/api.py join/leave/queue_status; Node server.js fallback (subprocess); JWT paylaÅŸÄ±mÄ± Redis; WS reconnection backoff; state Redis pub/sub ile korunur.

ğŸ’¡ GeniÅŸletici notlar: WS authâ€™ta Sec-WebSocket-Protocol: Bearer <JWT> veya sameâ€‘site cookie; mesaj ÅŸemasÄ± (JSON Schema) ve rolâ€‘bazlÄ± guard. Flood korumasÄ±.

Part 5: Utils ModÃ¼lleri GÃ¼ncellemesi

Senin talimatÄ±n: Dinamik TURN (ephemeral user/pwd), hibrit stateâ€‘store (Mongo/Redis), Sentry logging, Redis rate limit & caching layer.
Kod: get_turn_creds(), store_session(), handle_error() Ã¶rnekleri.

âš ï¸ Not: TURN TTL â‰¤ 5 dk, domain kÄ±sÄ±tÄ±, key rotasyonu ve global+hesap bazlÄ± limiter ayrÄ±mÄ± Part 17 ve Part 20â€™de detaylanÄ±r.

Part 6: WebRTC OptimizasyonlarÄ±

Senin talimatÄ±n: RTCPeerConnection + dinamik ICE (TURN), 720p@30 hedef; getDisplayMedia; dataChannel ile offline dosya gÃ¶nderimi; useSocket ile bandwidth event â†’ setParameters maxBitrate ayarla; battery check entegrasyonu.

ğŸ’¡ GeniÅŸletici notlar: ICE restart koÅŸullarÄ±, network switch (Wiâ€‘Fiâ†”LTE), getStats() tabanlÄ± karar; setParameters hata fallback.

Part 7: React Partials Ekleme

Senin talimatÄ±n: App.jsx + React Router v6; Index.jsx bekleme UI ve queue position; Admin.jsx sessizlik alert (Web Audio API); mount noktalarÄ±.

ğŸ’¡ GeniÅŸletici notlar: A11y (WCAG 2.1 AA), i18n, ErrorBoundary ve skeleton/boÅŸ durum bileÅŸenleri Part 24â€™te derinleÅŸtirilecek.

Part 8: Celery Tasks ve Kuyruklar

Senin talimatÄ±n: celery_tasks.py (Redis broker); nightly_report (PDF + eâ€‘posta, 23:00), silence_alert; BullMQ ile koordine; JSON state transfer.
GeniÅŸletme: retries/backoff, acks_late, DLQ, content hash ile idempotency.

Part 9: Test Suite GeniÅŸletme

Senin talimatÄ±n: tests/ â†’ 80+ test (Jest unit/e2e, Pytest integration); runner JSX; coverage raporu.

ğŸ’¡ GeniÅŸletici notlar: GÃ¼venlik testleri (auth bypass, CSRF, rate limit), yÃ¼k/soak/chaos testleri Part 20â€™de.

Part 10: Offline ve Mobil Ä°yileÅŸtirmeler

Senin talimatÄ±n: PWA service worker (install/fetch, offline fallback), Battery API ile dÃ¼ÅŸÃ¼k gÃ¼Ã§ modu, CSS responsive (@media).
ğŸ’¡ GeniÅŸletme: IndexedDBâ€™de ÅŸifreli saklama (WebCrypto), quota/temizlik.

Part 11: Bekleme KuyruÄŸu ve Admin Entegrasyonu

Senin talimatÄ±n: Adminâ€™de FIFO kuyruk yÃ¶netimi (queue-update, get-queue, pop-queue), Indexâ€™te position takibi.
ğŸ’¡ GeniÅŸletme: Ã–ncelik/etiket, starvation Ã¶nleme, eÅŸzamanlÄ± aktif gÃ¶rÃ¼ÅŸme limiti (token bucket).

Part 12: Tam Entegrasyon ve Hata Testleri

Senin talimatÄ±n: main.py â†’ legacy Node Ã§aÄŸrÄ±sÄ± (subprocess); e2e akÄ±ÅŸ (joinâ†’socketâ†’webrtcâ†’silenceâ†’report); hata senaryolarÄ± (disconnect, retry, ICE restart); JSON logger & Ã§ok dilli hata.

ğŸ’¡ GeniÅŸletme: Feature flags, RCA ÅŸablonu ve runbook giriÅŸleri.

Part 13: Deployment ve Monitoring (TamamlayÄ±cÄ±)

Senin talimatÄ±n: Dockerfile (multi-stage Node/Python), Prometheus metrics (utils/metrics.py), README komutlarÄ±, health/readiness probes, render.yaml.

ğŸ’¡ GeniÅŸletme: Zeroâ€‘downtime (blue/green), HPA ve rollback akÄ±ÅŸlarÄ± Part 22â€™de.

Part 14: Hibrit KÃ¶prÃ¼ler (Auth, Failover, Caching)

Senin talimatÄ±n: utils/bridge.py (JWT Redis paylaÅŸÄ±mÄ±, WS failover state transfer), Redis pub/sub ile cache invalidation; env sync YAML overlay.

ğŸ’¡ GeniÅŸletme: Token revocation list, clock skew, replay korumasÄ± (jti/nonce) â†’ Part 16 ile birlikte Ã§alÄ±ÅŸÄ±r.

Part 15: Monitoring & Performance (Observability, Jobs, Profiling)

Senin talimatÄ±n: OTel + Prometheus; Celery/BullMQ transfer finalize; profiling (flame graph).
ğŸ’¡ GeniÅŸletme: SLI/SLO ve hata bÃ¼tÃ§esi tanÄ±mlarÄ±; trace sampling politikasÄ±.

Benim BulduÄŸum Eksikleri Kapatacak Ek ParÃ§alar (16â€“24)

AÅŸaÄŸÄ±daki parÃ§alar, yukarÄ±daki notlarda iÅŸaretlediÄŸim tÃ¼m boÅŸluklarÄ± kapatÄ±r. Format, senin parÃ§alarÄ±nla aynÄ±dÄ±r.

Part 16: RBAC + MFA + Auth SertleÅŸtirme (Åart)

AmaÃ§: Sadece ÅŸifreli giriÅŸin zayÄ±flÄ±klarÄ±nÄ± gider; rol bazlÄ± yetki (admin/operator/viewer), MFA (TOTP/WebAuthn), logout & token revocation ekle.

AdÄ±mlar:

Rol/Ä°zin Matrisi: config/roles.yaml

resources:
  queue: [read, pop]
  reports: [read, generate]
  users: [read, create, disable]
roles:
  admin:    [queue:read,pop, reports:read,generate, users:read,create,disable]
  operator: [queue:read,pop, reports:read]
  viewer:   [queue:read]


MFA: TOTP (RFC 6238) veya WebAuthn (passkey).
Endpoints:

POST /api/admin/mfa/setup â†’ secret/QR (sadece ilk kurulum)

POST /api/admin/mfa/verify â†’ TOTP doÄŸrulama

Logout & Revocation:

POST /api/admin/logout â†’ Redis revoked:jti:<token> set

Access â‰¤15 dk, refresh â‰¤7 gÃ¼n, rotate refresh

CSRF/CORS: Cookieâ€‘based ise CSRF token; CORS allowlist.

Kod (Ã¶zet):

# routes/api.py
from fastapi import APIRouter, Depends, HTTPException
from utils.auth import issue_tokens, verify_totp, revoke_jti

@router.post("/api/admin/mfa/verify")
def mfa_verify(code: str = Body(...), user=Depends(require_user)):
    if not verify_totp(user.mfa_secret, code):
        raise HTTPException(401, "MFA invalid")
    return {"ok": True}

@router.post("/api/admin/logout")
def logout(token=Depends(current_access_token)):
    revoke_jti(token["jti"])
    return {"ok": True}


Neden? Prodâ€™da rol ayrÄ±mÄ±, ikinci faktÃ¶r ve revocation olmadan gÃ¼venlik hedefi yakalanamaz.
Test: YanlÄ±ÅŸ TOTP â†’ 401; revoke sonrasÄ± token â†’ 401.

Part 17: Secrets & Key Management + TLS + TURN Anahtar Rotasyonu

AmaÃ§: .envâ€™i prod iÃ§in sertleÅŸtir; KMS/Vault, otomatik TLS, TURN ephemeral TTL ve anahtar rotasyonu.

AdÄ±mlar:

Secrets YÃ¶netimi:

Staging/prodâ€™da KMS/Vault (Ã¶rn. AWS KMS/HashiCorp Vault)

JWT_SECRET, TURN_SECRET, DB parolalarÄ± buradan Ã§ekilir.

TLS & HSTS:

Letsâ€‘Encrypt otomasyonu, autoâ€‘renew

Strict-Transport-Security: max-age=63072000; includeSubDomains; preload

TURN:

Ephemeral cred TTL â‰¤5 dk

HaftalÄ±k key rotate job (Celery/BullMQ)

.env.example + SOPS:

config/secrets.enc.yaml (SOPS/age ile ÅŸifreli)

Neden? SÄ±zÄ±ntÄ± anÄ±nda hÄ±zlÄ± rotasyon olmadan risk bÃ¼yÃ¼r; TLS/HSTS olmadan trafik gÃ¼venliÄŸi zayÄ±f.
Test: Rotate sonrasÄ± eski token/cred geÃ§ersiz.

Part 18: API SÃ¶zleÅŸmesi, /v1 Versiyonlama, Idempotency, Hata SÃ¶zlÃ¼ÄŸÃ¼

AmaÃ§: Geriye dÃ¶nÃ¼k uyumluluk ve debug kolaylÄ±ÄŸÄ±.

AdÄ±mlar:

OpenAPI v3: Ã–zel hata modeli

{ "code": "AUTH_401", "message": "Invalid credentials", "correlationId": "..." }


Versiyonlama: TÃ¼m uÃ§lar /v1 prefix ile.

Idempotency-Key: Yazma uÃ§larÄ±nda baÅŸlÄ±k desteÄŸi; Redisâ€™te 24 saat cache.

Correlationâ€‘ID Middleware: X-Request-ID Ã¼ret/dÃ¶ndÃ¼r.

Neden? SÃ¶zleÅŸme ve idempotency olmadan entegrasyon kÄ±rÄ±lmalarÄ± yaÅŸanÄ±r.
Test: AynÄ± Idempotency-Key ile iki POST â†’ tek kaynak.

Part 19: KVKK/GDPR â€“ Onay, Retention, Maskeleme, Atâ€‘Rest Åifreleme

AmaÃ§: Ã‡aÄŸrÄ± kayÄ±tlarÄ± ve log PDFâ€™leri iÃ§in hukukÃ® ve teknik kontroller.

AdÄ±mlar:

Onay AkÄ±ÅŸÄ±: MÃ¼ÅŸteri arayÃ¼zÃ¼nde kayÄ±t/onay checkbox + audit trail.

Retention: VarsayÄ±lan 30/90 gÃ¼n; Celery job ile sil/anonimleÅŸtir.

Åifreleme: Dosya/DB iÃ§in AESâ€‘GCM (anahtar KMS); transit TLS.

DLP & Maskeleme: Log ve raporlarda PII maskeleme, optâ€‘out.

Neden? Uyumsuzluk riski yÃ¼ksek; mÃ¼ÅŸteri gÃ¼veni iÃ§in ÅŸart.
Test: SÃ¼resi dolan kayda eriÅŸim reddi; raporlarda PII maskesi.

Part 20: YÃ¼k/Soak/Chaos Testleri ve Performans BÃ¼tÃ§eleri

AmaÃ§: GerÃ§ek koÅŸullarda dayanÄ±klÄ±lÄ±k; SLOâ€™larÄ± doÄŸrulama.

AdÄ±mlar:

Performans BÃ¼tÃ§eleri:

p95 joinâ†’call â‰¤ 5 sn

ICE success rate â‰¥ %98

Login success â‰¥ %99.5

k6/Locust senaryolarÄ±: /api/join-queue, WS connect, offer/answer, datachannel.

Chaos: %5 paket kaybÄ±, 200 ms jitter, pod kill; SLO ihlali alarmÄ±.

Ã–rnek k6 iskeleti:

import http from 'k6/http';
import { check, sleep } from 'k6';
export let options = { vus: 50, duration: '3m' };
export default function () {
  const res = http.post('https://.../v1/api/join-queue', JSON.stringify({user_id:'k6'}), { headers: { 'Content-Type': 'application/json' }});
  check(res, { '200': (r) => r.status === 200 });
  sleep(1);
}


Neden? Kapasite planÄ± ve zayÄ±f halkalarÄ±n bulunmasÄ± iÃ§in zorunlu.
Test: Rapor: p95/99, error rate, SLA breach alarmÄ±.

Part 21: CI/CD & GÃ¼venlik TaramalarÄ± (SAST/DAST, SBOM, Image Scan)

AmaÃ§: Her mergeâ€™de prod kalitesine yakÄ±n gÃ¼ven.

AdÄ±mlar:

Pipeline: lint (flake8/eslint), test (Jest/Pytest), coverage â‰¥ %85, build, image scan.

SAST/DAST: Semgrep + OWASP ZAP; raporlarÄ± artifact et.

SBOM: Syft + Grype; baÄŸÄ±mlÄ±lÄ±k zafiyetleri.

Preâ€‘commit: black/isort/eslint + husky.

Ã–rnek GitHub Actions (Ã¶zet):

name: ci
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
      - run: pip install -r requirements.txt
      - run: pip install pytest
      - run: pytest -q
      - uses: actions/setup-node@v4
      - run: npm ci && npm test -- --ci --reporters=default


Neden? Regresyon ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± erken yakalamak.
Test: Coverage < %85 â†’ pipeline kÄ±rÄ±lmalÄ±.

Part 22: Orkestrasyon & SRE (K8s, HPA, Rolling/Blueâ€‘Green, Runbook)

AmaÃ§: %99+ uptime, Ã¶lÃ§eklenebilir ve gÃ¼venli yaygÄ±nlaÅŸtÄ±rma.

AdÄ±mlar:

K8s Manifests: Deployment, Service, Ingress(TLS), ConfigMap/Secret; liveness/readiness.

HPA: CPU ve/veya latency tabanlÄ±; TURN, API ayrÄ± Ã¶lÃ§eklenir.

Rollout: RollingUpdate; blue/green seÃ§eneÄŸi; otomatik rollback.

Runbook & RCA: ArÄ±za sÄ±nÄ±flarÄ±, playbook, RCA ÅŸablonu.

Ã–rnek HPA (Ã¶zet):

apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
spec:
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70


Neden? Trafik dalgalanmalarÄ±nda stabilite.
Test: Canary %10 â†’ %100; hata durumunda rollback.

Part 23: SFU Yol HaritasÄ± (mediasoup/Janus) â€“ Ã–lÃ§ek Ä°Ã§in

AmaÃ§: P2Pâ€™den SFU mimarisine geÃ§iÅŸ opsiyonu (Ã§ok katÄ±lÄ±mcÄ±, yÃ¼ksek eÅŸzamanlÄ±).

AdÄ±mlar:

Deneysel Bayrak: FEATURE_SFU=true iken SFU path; aksi P2P.

Signaling GeniÅŸletme: join_sfu_room, publish/subscribe semantiÄŸi.

Kaynak YÃ¶netimi: Simulcast/SVC, bitrate katmanlarÄ±, serverâ€‘side adaptasyon.

Metrikler: SFU CPU, publisher/subscriber sayÄ±larÄ±, e2e latency.

Neden? BÃ¼yÃ¼yen trafik iÃ§in sÃ¼rdÃ¼rÃ¼lebilir kalite.
Test: 1 admin + 10+ mÃ¼ÅŸteri senaryosu; p95 medya gecikmesi.

Part 24: A11y & i18n & UX DayanÄ±klÄ±lÄ±ÄŸÄ±

AmaÃ§: EriÅŸilebilirlik (WCAG 2.1 AA), Ã§ok dilli arayÃ¼z, hataya dayanÄ±klÄ± UX.

AdÄ±mlar:

A11y: Odak gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼, klavye navigasyonu, ARIA etiketleri, kontrast â‰¥ 4.5:1.

i18n: i18next (en/tr), tarih/sayÄ± yerelleÅŸtirme.

ErrorBoundary & BoÅŸ Durumlar: TÃ¼m sayfalarda; skeleton yÃ¼kleme; offline banner.

Form DoÄŸrulama: Clientâ€‘side schema, ekran okuyucu dostu hata mesajlarÄ±.

Neden? Daha geniÅŸ kullanÄ±cÄ± kitlesi, daha dÃ¼ÅŸÃ¼k destek maliyeti.
Test: Axe-core ile A11y denetimi; dil deÄŸiÅŸtirme persistansÄ±.

Global Kabul Kriterleri ve Kalite KapÄ±larÄ± (TÃ¼m ParÃ§alar Ä°Ã§in)

GÃ¼venlik BaÅŸlÄ±klarÄ±:
Strict-Transport-Security, Content-Security-Policy (nonceâ€™lu, dÄ±ÅŸ kaynak allowlist), X-Frame-Options: DENY, Referrer-Policy: no-referrer, X-Content-Type-Options: nosniff.

Cookie BayraklarÄ±: HttpOnly, Secure, SameSite=Lax/Strict.

JWT: shortâ€‘lived access, refresh rotate, revocation list, jti, nbf, clock skew toleransÄ±, replay korumasÄ±.

WS GÃ¼venliÄŸi: Handshakeâ€™de auth; mesaj baÅŸÄ±na yetki & ÅŸema doÄŸrulama; rate/flood limit.

TURN/STUN: Ephemeral TTL â‰¤ 5 dk, key rotasyonu, bÃ¶lge/failover; metriklerle ICE success â‰¥ %98.

Observability: Xâ€‘Requestâ€‘ID, structured logs (JSON), OTel tracing + Prometheus metrics, SLOâ€™lar (login success, ICE success, p95 joinâ†’call).

Test EÅŸiÄŸi: Coverage â‰¥ %85; gÃ¼venlik testleri; yÃ¼k/soak/chaos raporlarÄ±.

Uyum: Onay, retention, ÅŸifreleme, maskeleme; DLP kurallarÄ±.

DaÄŸÄ±tÄ±m: K8s + HPA; zeroâ€‘downtime rollout; rollback; runbook & RCA.

Ek Ã–rnek Snippetâ€™ler (HÄ±zlÄ± Uygulama Ä°Ã§in)

CSP (Ã¶rnek, sÄ±kÄ±laÅŸtÄ±rÄ±lacak):

Content-Security-Policy: default-src 'self'; script-src 'self' 'nonce-<RANDOM>'; connect-src 'self' wss://<domain>; img-src 'self' data:; style-src 'self' 'unsafe-inline'


Idempotency Middleware (FastAPI, Ã¶zet):

@app.middleware("http")
async def idempotency(request: Request, call_next):
    key = request.headers.get("Idempotency-Key")
    if request.method in ("POST","PUT","PATCH") and key:
        cache_key = f"idemp:{key}"
        if await redis.exists(cache_key):
            return JSONResponse(await redis.get(cache_key), status_code=200)
        resp = await call_next(request)
        if resp.status_code in (200,201):
            await redis.setex(cache_key, 86400, await resp.body())
        return resp
    return await call_next(request)


WS Auth (Ã¶zet):

@sio.event
async def connect(sid, environ, auth):
    token = auth.get("token") or environ.get("HTTP_SEC_WEBSOCKET_PROTOCOL_TOKEN")
    user = verify_jwt(token)
    if not user: return False
    await sio.save_session(sid, {"uid": user["sub"], "role": user["role"]})


Redis Rate Limit (IP + hesap):

def rate_limit(key, limit, window=60):
    now = int(time.time())
    pipe = redis.pipeline()
    pipe.zadd(key, {now: now})
    pipe.zremrangebyscore(key, 0, now-window)
    pipe.zcard(key)
    pipe.expire(key, window)
    _,_,count,_ = pipe.execute()
    return count <= limit

NasÄ±l KullanacaksÄ±n?

Bu MASTER promptu aynen (blok halinde) diÄŸer yapay zekÃ¢ aracÄ±na ver.

â€œTÃ¼m partâ€™lar iÃ§in hazÄ±rÄ±m. Part 1â€™i gÃ¶nder.â€ diye baÅŸlasÄ±n.

Her partÄ± tek tek ver: â€œÅimdi Part Xâ€™i uygulaâ€.

Her part sonunda modelin ÅŸu satÄ±rÄ± dÃ¶ndÃ¼rmesini zorunlu kÄ±l:
[PART X BÄ°TTÄ°] â€” "Bu kÄ±sÄ±m tamamlandÄ±. Sonraki part'Ä± bekliyorum."

1â€“15 bittiÄŸinde 16â€“24 ile benim tespit ettiÄŸim tÃ¼m eksikler de kapanmÄ±ÅŸ olacak.